---
import Layout from '../../layouts/Layout.astro';
import parse from 'node-html-parser';

export async function getStaticPaths() {
  const response = await fetch("https://api-eu-west-2.hygraph.com/v2/cl69huq4hdrg601t386sw5d49/master",
    {
      method:'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({
        query: `

          query getPosts {
              posts {
                  id
                  title
                  content {
                    html
                  }
              }
          }

          `,
      }),
    })

  const json = await response.json();
  const homecontent = json.data;

  return homecontent.posts.map((post) => {

    let cleanId = post.title.replace(/\s+/g, '-').toLowerCase();

    return {
      params: { id: cleanId },
      props: { post }
    };
  });
}
console.log(Astro.props)

const { id } = Astro.params;
const { post } = Astro.props;

const cleanContent = parse(post.content.html);

---
<Layout>
  <div class="section content">
    <h2>{post.title}</h2>
    <p>{cleanContent}</p>
  </div>
</Layout>


